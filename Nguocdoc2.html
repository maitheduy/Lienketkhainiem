<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MN–P & Double Cone Rolling Uphill</title>
<style>
body{
  margin:0;
  font-family:Inter,Segoe UI,Arial;
  background:#0f1724;
  color:#e6eef8;
}
.wrap{
  max-width:1250px;
  margin:20px auto;
  padding:20px;
  background:rgba(255,255,255,0.03);
  border-radius:12px;
  box-shadow:0 6px 25px rgba(0,0,0,0.6);
}
h1{margin:0 0 10px;font-size:22px;}
.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:18px;
}
.panel{
  background:rgba(255,255,255,0.03);
  padding:16px;
  border-radius:10px;
}
svg{
  width:100%;
  height:480px;
  background:rgba(255,255,255,0.02);
  border-radius:8px;
}
label{display:block;margin-top:8px;font-size:13px;color:#94a3b8;}
input[type=range]{width:100%;}
small{color:#94a3b8;}
.info{margin-top:10px;font-size:14px;line-height:1.5;}
.btn{
  padding:5px 10px;
  border:1px solid rgba(255,255,255,0.1);
  background:rgba(255,255,255,0.05);
  color:#e6eef8;
  border-radius:6px;
  cursor:pointer;
}
</style>
</head>
<body>
<div class="wrap">
<h1>Mô phỏng song song: Điểm nồng độ MN–P & Con lăn lăn ngược dốc (Double Cone)</h1>

<div class="grid">

<!-- LEFT: MN–P Model -->
<div class="panel">
<h3>1. Mô phỏng MN – P (Nồng độ ↔ Ta-lét)</h3>
<svg id="svgMN"></svg>

<div>
  <label>k = AM/MB: <span id="kVal">1</span></label>
  <input id="kSlider" type="range" min="0.1" max="5" step="0.01" value="1">

  <label>l = AN/NC: <span id="lVal">1</span></label>
  <input id="lSlider" type="range" min="0.1" max="5" step="0.01" value="1">
</div>

<div class="info">
Điểm <b>P</b> là “nồng độ trung bình có trọng số”.  
Khi <b>k = l</b> → MN ∥ BC (Định lý Ta-lét).  
Khi <b>k ≠ l</b> → MN nghiêng, giống như “sự chênh lệch nồng độ”.
</div>
</div>

<!-- RIGHT: Double Cone -->
<div class="panel">
<h3>2. Mô phỏng Double Cone – Lăn ngược dốc</h3>
<svg id="svgCone"></svg>

<div>
  <label>Độ nghiêng ray: <span id="slopeVal">8°</span></label>
  <input id="slopeSlider" type="range" min="2" max="15" step="0.1" value="8">

  <label>Độ mở hai thanh ray: <span id="gapVal">1.6</span></label>
  <input id="gapSlider" type="range" min="1" max="3" step="0.01" value="1.6">

  <button id="playBtn" class="btn">▶ Lăn</button>
</div>

<div class="info">
Con lăn hình nón kép <b>tự lăn lên dốc</b> vì khối tâm <b>CM thực sự đi xuống</b>.  
Điều này tương đương với việc điểm <b>P</b> trong mô hình MN–P có thể
<b>di chuyển theo hướng ngược trực giác</b>.
</div>
</div>

</div>
</div>

<script>
// ======================
// 1. MN–P SIMULATION
// ======================
const svgMN = document.getElementById("svgMN");
const kSlider = document.getElementById("kSlider");
const lSlider = document.getElementById("lSlider");
const kVal = document.getElementById("kVal");
const lVal = document.getElementById("lVal");

function drawMN() {
  const k = parseFloat(kSlider.value);
  const l = parseFloat(lSlider.value);

  kVal.textContent = k.toFixed(2);
  lVal.textContent = l.toFixed(2);

  svgMN.innerHTML = "";

  const A = {x:100, y:420};
  const B = {x:420, y:420};
  const C = {x:160, y:120};

  const alphaM = k/(k+1);
  const alphaN = l/(l+1);

  const M = {x:A.x + (B.x-A.x)*alphaM, y:A.y};
  const N = {x:A.x + (C.x-A.x)*alphaN, y:A.y + (C.y-A.y)*alphaN};

  // Weighted midpoint (simple average)
  const P = {x:(M.x+N.x)/2, y:(M.y+N.y)/2};

  // Draw triangle
  const tri = `
    <line x1="${A.x}" y1="${A.y}" x2="${B.x}" y2="${B.y}" stroke="#38bdf8" stroke-width="2"/>
    <line x1="${A.x}" y1="${A.y}" x2="${C.x}" y2="${C.y}" stroke="#60a5fa" stroke-width="2"/>
    <line x1="${B.x}" y1="${B.y}" x2="${C.x}" y2="${C.y}" stroke="#113f57" stroke-width="2" stroke-dasharray="6 6"/>

    <circle cx="${M.x}" cy="${M.y}" r="6" fill="#f97316"/>
    <circle cx="${N.x}" cy="${N.y}" r="6" fill="#f97316"/>
    <circle cx="${P.x}" cy="${P.y}" r="7" fill="#facc15"/>

    <line x1="${M.x}" y1="${M.y}" x2="${N.x}" y2="${N.y}" 
          stroke="${Math.abs(k-l)<0.01?'#4ade80':'#ffb78c'}" 
          stroke-width="3"/>

    <text x="${A.x-10}" y="${A.y+15}" fill="white">A</text>
    <text x="${B.x+10}" y="${B.y+15}" fill="white">B</text>
    <text x="${C.x}" y="${C.y-10}" fill="white">C</text>
  `;
  svgMN.innerHTML = tri;

  if (Math.abs(k-l) < 0.01) {
    svgMN.innerHTML += `<text x="250" y="40" fill="#4ade80" font-size="16">k = l ⇒ MN ∥ BC (Ta-lét)</text>`;
  }
}

drawMN();
kSlider.oninput = drawMN;
lSlider.oninput = drawMN;


// ===============================
// 2. DOUBLE CONE SIMULATION
// ===============================
const svgCone = document.getElementById("svgCone");
const slopeSlider = document.getElementById("slopeSlider");
const gapSlider = document.getElementById("gapSlider");
const slopeVal = document.getElementById("slopeVal");
const gapVal = document.getElementById("gapVal");
const playBtn = document.getElementById("playBtn");

let anim = null;
let pos = 0;

function drawCone() {
  const slope = parseFloat(slopeSlider.value);
  const gap = parseFloat(gapSlider.value);

  slopeVal.textContent = slope.toFixed(1) + "°";
  gapVal.textContent = gap.toFixed(2);

  svgCone.innerHTML = "";

  const yBase = 400;

  // two rails
  const x1 = 100, x2 = 350;
  const h = Math.tan(slope*Math.PI/180)*250;

  svgCone.innerHTML += `
    <line x1="${x1}" y1="${yBase}" x2="${x2}" y2="${yBase-h}" 
          stroke="#60a5fa" stroke-width="4"/>
    <line x1="${x1+gap*40}" y1="${yBase}" x2="${x2+gap*40}" y2="${yBase-h}"
          stroke="#60a5fa" stroke-width="4"/>
  `;

  // double cone
  const cx = x1 + pos*(x2-x1);
  const cy = yBase - pos*h;

  const r = 40 * (1-pos) + 10; // cone radius visually shrinks

  svgCone.innerHTML += `
    <ellipse cx="${cx+gap*20}" cy="${cy}" rx="${r}" ry="${14}" fill="#facc15"/>
    <ellipse cx="${cx+gap*20}" cy="${cy}" rx="${r*0.5}" ry="${7}" fill="#eab308"/>
  `;

  // CM (center of mass)
  svgCone.innerHTML += `
    <circle cx="${cx+gap*20}" cy="${cy}" r="5" fill="#ef4444"/>
  `;
}

function animate() {
  if (anim) return;
  anim = setInterval(()=>{
    pos += 0.005;
    if (pos>1){ pos=0; }
    drawCone();
  },16);
}

playBtn.onclick = animate;

drawCone();
slopeSlider.oninput = drawCone;
gapSlider.oninput = drawCone;

</script>

</body>
</html>
